<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ホワサバ 集結開始時間計算</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input[type=number] { width: 60px; }
    button { margin-top: 10px; padding: 6px 12px; }
  </style>
</head>
<body>
  <h2>ホワイトアウトサバイバル - 集結開始時間計算</h2>

  <table id="playersTable">
    <thead>
      <tr>
        <th>プレイヤー名</th>
        <th>行軍分</th>
        <th>行軍秒</th>
        <th>集結開始時間（秒）</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="playersBody">
      <tr>
        <td><input type="text" value="プレイヤー1" class="name" /></td>
        <td><input type="number" min="0" value="0" class="min" /></td>
        <td><input type="number" min="0" max="59" value="10" class="sec" /></td>
        <td class="result">-</td>
        <td><button onclick="removeRow(this)">削除</button></td>
      </tr>
      <tr>
        <td><input type="text" value="プレイヤー2" class="name" /></td>
        <td><input type="number" min="0" value="0" class="min" /></td>
        <td><input type="number" min="0" max="59" value="20" class="sec" /></td>
        <td class="result">-</td>
        <td><button onclick="removeRow(this)">削除</button></td>
      </tr>
    </tbody>
  </table>

  <button onclick="addPlayer()">プレイヤー追加</button>
  <button onclick="calculate()">計算する</button>

  <script>
    // プレイヤー行追加
    function addPlayer() {
      const tbody = document.getElementById("playersBody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" value="新しいプレイヤー" class="name" /></td>
        <td><input type="number" min="0" value="0" class="min" /></td>
        <td><input type="number" min="0" max="59" value="0" class="sec" /></td>
        <td class="result">-</td>
        <td><button onclick="removeRow(this)">削除</button></td>
      `;
      tbody.appendChild(row);
    }

    // 行削除
    function removeRow(button) {
      const tr = button.closest("tr");
      tr.remove();
    }

    // 計算処理
    function calculate() {
      const rows = document.querySelectorAll("#playersBody tr");
      if (rows.length === 0) {
        alert("プレイヤーを1人以上追加してください。");
        return;
      }

      const times = [];

      // x_iを秒数で取得
      for (const row of rows) {
        const min = parseInt(row.querySelector(".min").value) || 0;
        const sec = parseInt(row.querySelector(".sec").value) || 0;
        if (sec < 0 || sec > 59) {
          alert("秒は0から59の範囲で入力してください。");
          return;
        }
        times.push(min * 60 + sec);
      }

      // 平均x_ave
      const x_ave = times.reduce((a, b) => a + b, 0) / times.length;
      const x_a = Math.floor(x_ave);

      // y_i = x_a - x_i
      const y_i = times.map(t => x_a - t);

      // y_a = |最小値|
      const minVal = Math.min(...y_i);
      const y_a = Math.abs(minVal);

      // z_i = y_a + y_i
      const z_i = y_i.map(val => y_a + val);

      // 結果を表示
      rows.forEach((row, i) => {
        row.querySelector(".result").textContent = `${z_i[i]} 秒`;
      });
    }
  </script>
</body>
</html>
